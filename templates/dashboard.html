<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f7f7f7;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background-color: #e6f2e6;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .sidebar h2 {
            color: #68a469;
            font-size: 22px;
            margin-bottom: 10px;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
            font-size: 14px;
            color: #333;
        }

        .sidebar .btn {
            background-color: #749275;
            color: white;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 5px;
            display: block;
            margin: 15px 0;
            text-align: center;
        }

        .sidebar .btn:hover {
            background-color: #324932;
        }

        .sidebar a.logout {
            margin-top: 20px;
            color: #d9534f;
            text-decoration: none;
            font-weight: bold;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #68a469;
            margin-bottom: 15px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
<div class="container">
    <!-- Sidebar Start -->
    <div class="sidebar">
        <div>
            <h2>Profile</h2>
            <ul>
                <li><strong>Name:</strong> {{ user_info['profile']['name'] }}</li>
                <li><strong>Email:</strong> {{ user_info['profile']['email'] }}</li>
                <li><strong>Phone:</strong> {{ user_info['details']['phone'] }}</li>
                <li><strong>Address:</strong> {{ user_info['details']['address'] }}</li>
                <li><strong>Division:</strong> {{ user_info['details']['division'] }}</li>
            </ul>

            <h2>Providers</h2>
            <ul>
                <li><strong>Electricity:</strong> {{ user_info['details']['electricity_provider'] }}</li>
                <li><strong>Water:</strong> {{ user_info['details']['water_provider'] }}</li>
                <li><strong>Gas:</strong> {{ user_info['details']['gas_provider'] }}</li>
                <li><strong>Gas Type:</strong> {{ user_info['details']['gas_type'] }}</li>
            </ul>

            <h2>Housing</h2>
            {% if user_info['housing'] %}
            <ul>
                <li><strong>House Size:</strong> {{ user_info['housing']['house_size_sqft'] }} sqft</li>
                <li><strong>Members:</strong> {{ user_info['housing']['num_members'] }}</li>
                <li><strong>Solar Watt:</strong> {{ user_info['housing']['solar_panel_watt'] }} W</li>
                <li><strong>Wind Watt:</strong> {{ user_info['housing']['wind_source_watt'] }} W</li>
            </ul>
            {% else %}
            <p>No housing info</p>
            {% endif %}

            <h2>Cars</h2>
            {% if user_info['cars'] %}
            <ul>
                {% for car in user_info['cars'] %}
                <li>{{ car }}</li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No cars added</p>
            {% endif %}

            <a href="{{ url_for('update_user') }}" class="btn">Update Info</a>
        </div>

        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </div>
    <!-- Sidebar End -->

    <!-- Main Content Start -->
    <div class="main-content">
        <div class="section">
            <h2>Daily Electricity Consumption (Last 15 Days)</h2>
            <canvas id="dailyConsumptionChart"></canvas>
        </div>

        <div class="section">
            <h2>Electricity Usage Histogram</h2>
            <canvas id="electricityHistogramChart"></canvas>
        </div>

        <div class="section">
            <h2>Daily Water Consumption (Last 15 Days)</h2>
            <canvas id="dailyWaterConsumptionChart"></canvas>
        </div>

        <div class="section">
            <h2>Water Usage Histogram</h2>
            <canvas id="waterHistogramChart"></canvas>
        </div>

        <div class="section">
            <h2>Daily Gas Consumption (Last 15 Days)</h2>
            <canvas id="dailyGasConsumptionChart"></canvas>
        </div>

        <div class="section">
            <h2>Gas Usage Histogram</h2>
            <canvas id="gasHistogramChart"></canvas>
        </div>

        <div class="section">
            <h2>Daily Fuel Consumption (Last 15 Days)</h2>
            <canvas id="dailyFuelConsumptionChart"></canvas>
        </div>

        <div class="section">
            <h2>Fuel Usage Histogram</h2>
            <canvas id="fuelHistogramChart"></canvas>
        </div>

        <div class="section">
            <h2>Bills</h2>
            <a href="{{ url_for('view_electricity_bills') }}" class="btn">View Electricity Bills</a>
            <a href="{{ url_for('view_water_bills') }}" class="btn">View Water Bills</a>
            <a href="{{ url_for('view_gas_bills') }}" class="btn">View Gas Bills</a>
            <a href="{{ url_for('view_fuel_bills') }}" class="btn">View Fuel Bills</a>
        </div>

        <div class="section">
            <h2>Daily Carbon Footprint (Last 15 Days)</h2>
            <canvas id="dailyCarbonChart"></canvas>
        </div>

        <div class="section">
            <h2>Monthly Carbon Footprint</h2>
            <canvas id="carbonHistogramChart"></canvas>
        </div>

        <div class="section" style="display: flex; justify-content: center;">
            <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.1); max-width: 400px;">
                <h2 style="color: #68a469;">Current Emission Level</h2>
                <canvas id="emissionLevelChart" style="max-width: 300px; height: 300px;"></canvas>
                <p style="margin-top: 20px; font-size: 1.2rem; text-align: center;">
                    You are emitting:
                    <strong style="color: {{ 'red' if average_emission_level == 'high' else 'orange' if average_emission_level == 'moderate' else 'green' }};">
                        {{ average_emission_level|capitalize }}
                    </strong> amount of CO₂.
                </p>
            </div>
        </div>
    </div>
    <!-- Main Content End -->

</div>
    

    

    <div class="section">
        <a href="{{ url_for('update_user') }}" class="btn">Update Your Information</a>
    </div>

    <p><a href="{{ url_for('logout') }}">Logout</a></p>



    <script>
        // Get recent consumption data from the template
        const recentConsumption = {{ recent_consumption | tojson}};

        // Extract the dates, units, and bills for the graph
        const labels = recentConsumption.map(record => record.date);
        const units = recentConsumption.map(record => record.units);
        const bills = recentConsumption.map(record => record.bill);

        // Create the chart
        const ctx = document.getElementById('dailyConsumptionChart').getContext('2d');
        const dailyConsumptionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels, // Dates
                datasets: [
                    {
                        label: 'Consumed Taka (Tk)',
                        data: bills, // Daily Bills
                        borderColor: 'rgba(85, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Consumed Units (kWh)',
                        data: units, // Units Consumed
                        borderColor: 'rgba(255, 205, 86, 1)',
                        backgroundColor: 'rgba(255, 205, 86, 0.2)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Value'
                        }
                    }
                }
            }
        });
    </script>



    <script>
        // Get monthly electricity data from the backend
        const monthlyElectricityData = {{ monthly_electricity_data | tojson }};

        // Format month and year labels for histogram
        const histogramLabels = monthlyElectricityData.map(
            record => `${record.bill_month}/${record.bill_year}`
        );

        // Extract total units consumed
        const histogramData = monthlyElectricityData.map(record => record.total_units);
        const histogramBills = monthlyElectricityData.map(record => record.total_bill);

        // Create the histogram chart
        const ctxHistogram = document.getElementById('electricityHistogramChart').getContext('2d');
        const electricityHistogramChart = new Chart(ctxHistogram, {
            type: 'bar',
            data: {
                labels: histogramLabels,
                datasets: [{
                    label: 'Electricity Usage (kWh)',
                    data: histogramData,
                    backgroundColor: 'rgba(95, 192, 192, 0.6)',
                    borderColor: 'rgba(105, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const units = context.raw;
                                const index = context.dataIndex;
                                const bill = histogramBills[index];
                                return [
                                    `Units: ${units.toFixed(2)} kWh`,
                                    `Bill: ${bill.toFixed(2)} Tk`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: { title: { display: true, text: 'Month/Year' } },
                    y: { title: { display: true, text: 'Electricity Usage (kWh)' }, beginAtZero: true }
                }
            }
        });
    </script>


    <script>
        // Get recent water consumption data
        const recentWaterConsumption = {{ recent_water_consumption | tojson }};

        const waterLabels = recentWaterConsumption.map(record => record.date);
        const liters = recentWaterConsumption.map(record => record.liters);
        const waterBills = recentWaterConsumption.map(record => record.bill);

        // Create the water consumption chart
        const ctxWater = document.getElementById('dailyWaterConsumptionChart').getContext('2d');
        const dailyWaterConsumptionChart = new Chart(ctxWater, {
            type: 'line',
            data: {
                labels: waterLabels,
                datasets: [
                    {
                        label: 'Consumed Taka (Tk)',
                        data: waterBills,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Consumed Water (Liters)',
                        data: liters,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'Value' }, beginAtZero: true }
                }
            }
        });

    </script>



    <script>
        // Get monthly water data from the backend
        const monthlyWaterData = {{ monthly_water_data | tojson }};

        // Format month and year labels for water histogram
        const waterHistogramLabels = monthlyWaterData.map(
            record => `${record.month}/${record.year}`
        );

        // Extract total liters consumed
        const waterHistogramData = monthlyWaterData.map(record => record.total_liters);
        const waterHistogramBills = monthlyWaterData.map(record => record.total_bill);

        // Create the water histogram chart
        const ctxWaterHistogram = document.getElementById('waterHistogramChart').getContext('2d');
        const waterHistogramChart = new Chart(ctxWaterHistogram, {
            type: 'bar',
            data: {
                labels: waterHistogramLabels,
                datasets: [{
                    label: 'Water Usage (Liters)',
                    data: waterHistogramData,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const liters = context.raw;
                                const index = context.dataIndex;
                                const bill = waterHistogramBills[index];
                                return [
                                    `Liters: ${liters.toFixed(2)} L`,
                                    `Bill: ${bill.toFixed(2)} Tk`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: { title: { display: true, text: 'Month/Year' } },
                    y: { title: { display: true, text: 'Water Usage (Liters)' }, beginAtZero: true }
                }
            }
        });
    </script>


    <script>
        const recentGasConsumption = {{ recent_gas_consumption | tojson }};
        const gasLabels = recentGasConsumption.map(record => record.date);
        const cubicMeters = recentGasConsumption.map(record => record.cubic_meters);
        const gasBills = recentGasConsumption.map(record => record.bill);

        const ctxGas = document.getElementById('dailyGasConsumptionChart').getContext('2d');
        const dailyGasConsumptionChart = new Chart(ctxGas, {
            type: 'line',
            data: {
                labels: gasLabels,
                datasets: [
                    {
                        label: 'Gas Cost (Tk)',
                        data: gasBills,
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Gas Used (Cubic Meters)',
                        data: cubicMeters,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'Value' }, beginAtZero: true }
                }
            }
        });

    </script>


    <script>
        const monthlyGasData = {{ monthly_gas_data | tojson }};
        const gasHistogramLabels = monthlyGasData.map(record => `${record.month}/${record.year}`);
        const gasHistogramData = monthlyGasData.map(record => record.total_cubic_meters);
        const gasHistogramBills = monthlyGasData.map(record => record.total_bill);

        const ctxGasHistogram = document.getElementById('gasHistogramChart').getContext('2d');
        const gasHistogramChart = new Chart(ctxGasHistogram, {
            type: 'bar',
            data: {
                labels: gasHistogramLabels,
                datasets: [{
                    label: 'Gas Usage (Cubic Meters)',
                    data: gasHistogramData,
                    backgroundColor: 'rgba(255, 159, 64, 0.6)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const usage = context.raw;
                                const index = context.dataIndex;
                                const bill = gasHistogramBills[index];
                                return [`Gas Used: ${usage.toFixed(2)} m³`, `Bill: ${bill.toFixed(2)} Tk`];
                            }
                        }
                    }
                },
                scales: {
                    x: { title: { display: true, text: 'Month/Year' } },
                    y: { title: { display: true, text: 'Gas Usage (m³)' }, beginAtZero: true }
                }
            }
        });
    </script>

    <script>
        const recentFuelConsumption = {{ recent_fuel_consumption | tojson }};
        const fuelLabels = recentFuelConsumption.map(record => record.date);
        const fuelLiters = recentFuelConsumption.map(record => record.liters);
        const fuelBills = recentFuelConsumption.map(record => record.bill);

        const ctxFuel = document.getElementById('dailyFuelConsumptionChart').getContext('2d');
        const dailyFuelConsumptionChart = new Chart(ctxFuel, {
            type: 'line',
            data: {
                labels: fuelLabels,
                datasets: [
                    {
                        label: 'Fuel Cost (Tk)',
                        data: fuelBills,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Fuel Used (Liters)',
                        data: fuelLiters,
                        borderColor: 'rgba(201, 203, 207, 1)',
                        backgroundColor: 'rgba(201, 203, 207, 0.2)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'Value' }, beginAtZero: true }
                }
            }
        });

    </script>

    <script>
        const monthlyFuelData = {{ monthly_fuel_data | tojson }};
        const fuelHistogramLabels = monthlyFuelData.map(record => `${record.month}/${record.year}`);
        const fuelHistogramData = monthlyFuelData.map(record => record.total_liters);
        const fuelHistogramBills = monthlyFuelData.map(record => record.total_bill);

        const ctxFuelHistogram = document.getElementById('fuelHistogramChart').getContext('2d');
        const fuelHistogramChart = new Chart(ctxFuelHistogram, {
            type: 'bar',
            data: {
                labels: fuelHistogramLabels,
                datasets: [{
                    label: 'Fuel Usage (Liters)',
                    data: fuelHistogramData,
                    backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const usage = context.raw;
                                const index = context.dataIndex;
                                const bill = fuelHistogramBills[index];
                                return [`Liters: ${usage.toFixed(2)} L`, `Bill: ${bill.toFixed(2)} Tk`];
                            }
                        }
                    }
                },
                scales: {
                    x: { title: { display: true, text: 'Month/Year' } },
                    y: { title: { display: true, text: 'Fuel Usage (Liters)' }, beginAtZero: true }
                }
            }
        });
    </script>

    <script>
        const recentCarbon = {{ recent_carbon_footprint | tojson }};

        const carbonLabels = recentCarbon.map(record => record.date);
        const carbonKg = recentCarbon.map(record => record.carbon_kg);

        const ctxCarbon = document.getElementById('dailyCarbonChart').getContext('2d');
        const dailyCarbonChart = new Chart(ctxCarbon, {
            type: 'line',
            data: {
                labels: carbonLabels,
                datasets: [{
                    label: 'Daily CO₂ Emissions (kg)',
                    data: carbonKg,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'CO₂ Emissions (kg)' }, beginAtZero: true }
                }
            }
        });
    </script>



    <script>
        const monthlyCarbon = {{ monthly_carbon_data | tojson }};
        const carbonHistogramLabels = monthlyCarbon.map(record => `${record.month}/${record.year}`);
        const monthlyCarbonKg = monthlyCarbon.map(record => record.total_carbon_kg);

        const ctxCarbonHistogram = document.getElementById('carbonHistogramChart').getContext('2d');
        const carbonHistogramChart = new Chart(ctxCarbonHistogram, {
            type: 'bar',
            data: {
                labels: carbonHistogramLabels,
                datasets: [{
                    label: 'Monthly CO₂ Emissions (kg)',
                    data: monthlyCarbonKg,
                    backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: 'Month/Year' } },
                    y: { title: { display: true, text: 'CO₂ (kg)' }, beginAtZero: true }
                }
            }
        });
    </script>

<script>
    const emissionPercentage = {{ 100 if average_emission_level == 'high' else 66 if average_emission_level == 'moderate' else 33 }};
    const remainingPercentage = 100 - emissionPercentage;

    const ctxEmissionLevel = document.getElementById('emissionLevelChart').getContext('2d');
    const emissionLevelChart = new Chart(ctxEmissionLevel, {
        type: 'doughnut',
        data: {
            labels: ['Your Emissions', 'Remaining Safe Limit'],
            datasets: [{
                data: [emissionPercentage, remainingPercentage],
                backgroundColor: [
                    emissionPercentage >= 80 ? 'rgba(255, 99, 132, 0.7)' : 
                    emissionPercentage >= 50 ? 'rgba(255, 205, 86, 0.7)' : 
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(200, 200, 200, 0.3)'
                ],
                borderColor: [
                    emissionPercentage >= 80 ? 'rgba(255, 99, 132, 1)' :
                    emissionPercentage >= 50 ? 'rgba(255, 205, 86, 1)' :
                    'rgba(75, 192, 192, 1)',
                    'rgba(200, 200, 200, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            cutout: '70%',
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.raw + '%';
                        }
                    }
                },
                legend: {
                    display: true,
                    position: 'bottom'
                }
            }
        }
    });
</script>

</body>

</html>